# Dockerfile for Brain Protocol Agent
# Used in e2e tests to simulate multiple independent agents

FROM python:3.11-slim

# Install git and openssh for git operations
RUN apt-get update && apt-get install -y \
    git \
    openssh-client \
    openssl \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace

# Copy source code
COPY src/ /workspace/src/
COPY requirements.txt /workspace/
COPY pytest.ini /workspace/

# Install Python dependencies (none required, but future-proof)
RUN pip install --no-cache-dir -r requirements.txt || true

# Set up Python path
ENV PYTHONPATH=/workspace/src

# Configure git (will be overridden per agent)
RUN git config --global init.defaultBranch main

# Create entrypoint script
COPY e2e/entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Default command
ENTRYPOINT ["/entrypoint.sh"]
CMD ["idle"]

